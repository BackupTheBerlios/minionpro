#!/bin/bash

mkdir -p pfb tfm vf dvips

echo "Creating PostScript fonts ..."

for font in otf/*.otf
do
  base=$(basename $font .otf)
  cfftot1    $font     $base.pfb
  t1dotlessj $base.pfb ${base}LCDFJ.pfb
done

echo "Creating TeX metrics ..."

maketfm() {
  local family="$1"
  shift

  set -o pipefail
  { scripts/maketfm $family "$@" | sort -u > dvips/$family.map; } 2>&1 |
  { perl scripts/filtererr || cat; }
}

if ! maketfm MinionPro "$@"
then
  echo "maketfm failed, exiting ..."
  exit 1
fi

mv *.pfb pfb

(cd fontinst; ../scripts/makeint MinionPro; ../scripts/makeoml MinionPro)

(cd tex; latex MinionPro.ins; latex otfontdef.ins; latex fontaxes.ins)
