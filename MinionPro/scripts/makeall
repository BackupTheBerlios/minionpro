#!/bin/bash

mkdir -p pfb tfm vf dvips

./scripts/convert-lcdf

echo "Creating TeX metrics ..."

maketfm() {
  local family="$1"
  shift

  # We pass the error code of maketfm via a stamp file.
  touch maketfm.error

  ( scripts/maketfm "$family" "$@" >"dvips/$family.map.tmp" && rm maketfm.error ) 2>&1 |
  ( perl scripts/filtererr || cat )

  sort -u <"dvips/$family.map.tmp" >"dvips/$family.map"
  rm "dvips/$family.map.tmp"
}

maketfm MinionPro "$@"

if [ -e maketfm.error ]
then
  rm maketfm.error
  echo "maketfm failed, exiting ..."
  exit 1
fi

(cd fontinst; ../scripts/makeint MinionPro; ../scripts/makeoml MinionPro)

(cd tex; latex MinionPro.ins; latex otfontdef.ins; latex fontaxes.ins)

