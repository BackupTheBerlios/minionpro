#!/bin/sh

font=$1

if [ "x$font" = "" ]
then
  echo "No font specified!";
  echo "USAGE: maketfm <font>";
  exit 1
fi

make_tfm() {
  echo -n " $3," >&2
  otftotfm --no-dotlessj -fliga -fkern $4 -e enc/mn-$2.enc otf/$font-$1.otf $font-$1-$3
#  otftotfm -q -a -fliga -fkern $4 -e enc/mn-$2.enc otf/$font-$1.otf $font-$1-$3>/dev/null
}

make_normal_metrics() {

  make_tfm "$1" t1     $2-t1        "$3"
  make_tfm "$1" ot1    $2-ot1       "$3"
  make_tfm "$1" lgr    $2-lgr       "$3 -sgrek"
  make_tfm "$1" ly1    $2-ly1       "$3"
  make_tfm "$1" t2a    $2-t2a       "$3 -scyrl"
  make_tfm "$1" t2b    $2-t2b       "$3 -scyrl"
  make_tfm "$1" t2c    $2-t2c       "$3 -scyrl"
  make_tfm "$1" x2     $2-x2        "$3 -scyrl"

  make_tfm "$1" t1     $2-sc-t1     "$3 -fsmcp"
  make_tfm "$1" ot1    $2-sc-ot1    "$3 -fsmcp"

  make_tfm "$1" t1     $2-sc-l2-t1  "-L 80 $3 -fsmcp"
  make_tfm "$1" ot1    $2-sc-l2-ot1 "-L 80 $3 -fsmcp"
}

make_normal_ts1_metrics() {

  make_tfm "$1" ts1 $2-ts1       "$3"
  make_tfm "$1" ts1 $2-sc-ts1    "$3 -fsmcp"
  make_tfm "$1" ts1 $2-sc-l2-ts1 "-L 80 $3 -fsmcp"
}

make_oml_metrics() {

  make_tfm "$1" oml $2-oml       "$3"
  make_tfm "$1" oml $2-l1-oml    "-L 40 $3"
  make_tfm "$1" oml $2-cn-oml    "-E 0.9 $3"
  make_tfm "$1" oml $2-cn-l1-oml "-E 0.9 -L 40 $3"
}

make_spread_metrics() {

  make_tfm "$1" t1     $2-l1-t1     "-L 40 $3"
  make_tfm "$1" ot1    $2-l1-ot1    "-L 40 $3"
  make_tfm "$1" lgr    $2-l1-lgr    "-L 40 $3 -sgrek"
  make_tfm "$1" ly1    $2-ly1       "-L 40 $3"
  make_tfm "$1" t2a    $2-l1-t2a    "-L 40 $3 -scyrl"
  make_tfm "$1" t2b    $2-l1-t2b    "-L 40 $3 -scyrl"
  make_tfm "$1" t2c    $2-l1-t2c    "-L 40 $3 -scyrl"
  make_tfm "$1" x2     $2-l1-x2     "-L 40 $3 -scyrl"
  make_tfm "$1" sc-t1  $2-sc-l1-t1  "-L 40 $3 -fsmcp"
  make_tfm "$1" sc-ot1 $2-sc-l1-ot1 "-L 40 $3 -fsmcp"
}

make_spread_ts1_metrics() {

  make_tfm "$1" ts1 $2-l1-ts1    "-L 40 $3"
  make_tfm "$1" ts1 $2-sc-l1-ts1 "-L 40 $3 -fsmcp"
}

make_metrics() {

  echo -n "Processing font $font-$1 ..." >&2

  make_normal_metrics     "$1" lf   "-flnum -fpnum"
  make_normal_metrics     "$1" tlf  "-flnum -ftnum"
  make_normal_metrics     "$1" osf  "-fonum -fpnum"
  make_normal_metrics     "$1" tosf "-fonum -ftnum"

  make_normal_ts1_metrics "$1" lf   "-fonum -fpnum"
  make_normal_ts1_metrics "$1" tlf  "-fonum -ftnum"
  make_normal_ts1_metrics "$1" osf  "-flnum -fpnum"
  make_normal_ts1_metrics "$1" tosf "-flnum -ftnum"

  make_oml_metrics        "$1" lf   "-flnum -ftnum"
  make_oml_metrics        "$1" tlf  "-flnum -fpnum"
  make_oml_metrics        "$1" osf  "-fonum -ftnum"
  make_oml_metrics        "$1" tosf "-fonum -fpnum"

  make_tfm "$1" orn-u orn-u ""

  echo " done." >&2
}

make_spaced_metrics() {

  echo -n "Processing font $font-$1 ..." >&2

  make_spread_metrics     "$1" lf   "-flnum -fpnum"
  make_spread_metrics     "$1" tlf  "-flnum -ftnum"
  make_spread_metrics     "$1" osf  "-fonum -fpnum"
  make_spread_metrics     "$1" tosf "-fonum -ftnum"

  make_spread_ts1_metrics "$1" lf   "-fonum -fpnum"
  make_spread_ts1_metrics "$1" tlf  "-fonum -ftnum"
  make_spread_ts1_metrics "$1" osf  "-flnum -fpnum"
  make_spread_ts1_metrics "$1" tosf "-flnum -ftnum"

  echo " done." >&2
}

make_swash_metrics() {

  echo -n "Processing font $font-$1 ..." >&2

  make_tfm "$1" t1  lf-swash-t1    "-flnum -fpnum -fswsh"
  make_tfm "$1" ot1 lf-swash-ot1   "-flnum -fpnum -fswsh"
  make_tfm "$1" t1  osf-swash-t1   "-fonum -fpnum -fswsh"
  make_tfm "$1" ot1 osf-swash-ot1  "-fonum -fpnum -fswsh"
  make_tfm "$1" t1  tlf-swash-t1   "-flnum -ftnum -fswsh"
  make_tfm "$1" ot1 tlf-swash-ot1  "-flnum -ftnum -fswsh"
  make_tfm "$1" t1  tosf-swash-t1  "-fonum -ftnum -fswsh"
  make_tfm "$1" ot1 tosf-swash-ot1 "-fonum -ftnum -fswsh"

  echo " done." >&2
}

make_spaced_swash_metrics() {

  echo -n "Processing font $font-$1 ..." >&2

  make_tfm "$1" t1  lf-swash-l1-t1    "-L 40 -flnum -fpnum -fswsh"
  make_tfm "$1" ot1 lf-swash-l1-ot1   "-L 40 -flnum -fpnum -fswsh"
  make_tfm "$1" t1  osf-swash-l1-t1   "-L 40 -fonum -fpnum -fswsh"
  make_tfm "$1" ot1 osf-swash-l1-ot1  "-L 40 -fonum -fpnum -fswsh"
  make_tfm "$1" t1  tlf-swash-l1-t1   "-L 40 -flnum -ftnum -fswsh"
  make_tfm "$1" ot1 tlf-swash-l1-ot1  "-L 40 -flnum -ftnum -fswsh"
  make_tfm "$1" t1  tosf-swash-l1-t1  "-L 40 -fonum -ftnum -fswsh"
  make_tfm "$1" ot1 tosf-swash-l1-ot1 "-L 40 -fonum -ftnum -fswsh"

  echo " done." >&2
}

make_series() {

  for sub in "" Capt Disp Subh
  do
    if [ "x$1$sub" = "x" ]
    then
      make_metrics Regular
    else
      make_metrics "$1$sub"
    fi
  done

#  if [ "x$1" = "x" ]
#  then 
#    make_spaced_metrics Regular
#  else
#    make_spaced_metrics "$1"
#  fi
  make_spaced_metrics "$1Capt"
}

make_additional_italic() {

  for sub in "" Capt Disp Subh
  do
    make_swash_metrics "$1$sub"
  done

  make_spaced_swash_metrics "$1"
  make_spaced_swash_metrics "$1Capt"
}

for series in "" Semibold Bold
do
  make_series "$series" #&
  make_series "${series}It"

  make_additional_italic  "${series}It"
done

