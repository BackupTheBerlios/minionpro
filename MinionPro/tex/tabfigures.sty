\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{tabfigures}[2007/03/30 v0.1 Tabular figures (patches)]

% Debugging
\newif\ifTf@debug \Tf@debugfalse
\DeclareOption{debug}{%
  \Tf@debugtrue
}

% Equation numbers
\DeclareOption{eqno}{%
  \AtBeginDocument{%
    \@ifpackageloaded{amsmath}{%
      \Tf@def\maketag@@@#1{\Tf@\maketag@@@{\Tf@font #1}}%
    }{%
      \CheckCommand*\@eqnnum{{\normalfont \normalcolor (\theequation)}}%
      \def\@eqnnum{{\normalfont \Tf@font \normalcolor (\theequation)}}%
    }%
  }%
}

% ToC, LoF, LoT, etc.
\DeclareOption{toc}{%
  \AtBeginDocument{%
% generic
    \Tf@def\@dottedtocline#1#2#3#4#5{
      \Tf@\@dottedtocline{#1}{#2}{#3}{#4}{\Tf@font #5}%
    }%
    \Tf@def\numberline#1{%
      \Tf@\numberline{\Tf@font #1}%
    }%
    \Tf@patch@l{part}%
    \Tf@patch@l{chapter}%
    \Tf@patch@l{section}%
    \Tf@patch@l{subsection}%
    \Tf@patch@l{subsubsection}%
    \Tf@patch@l{paragraph}%
    \Tf@patch@l{subparagraph}%
    \Tf@patch@l{figure}%
    \Tf@patch@l{table}%
% memoir
    \@ifclassloaded{memoir}{%
      \Tf@def\cftchapterpresnum{\Tf@font \Tf@\cftchapterpresnum}%
      \Tf@def\cftpartpresnum{\Tf@font \Tf@\cftpartpresnum}%
    }{}%
  }%
}

% enumerate
\DeclareOption{enum}{%
  \AtBeginDocument{%
    \Tf@def\labelenumi{\Tf@font \Tf@\labelenumi}%
    \Tf@def\labelenumii{\Tf@font \Tf@\labelenumii}%
    \Tf@def\labelenumiii{\Tf@font \Tf@\labelenumiii}%
    \Tf@def\labelenumiv{\Tf@font \Tf@\labelenumiv}%
  }%
}

% bibliography: labels
\DeclareOption{bib}{%
  \AtBeginDocument{%
    \Tf@def\@biblabel{\Tf@font \Tf@\@biblabel}%
  }%
}

\ProcessOptions\relax

% Used for switching to tabular figures
\newcommand*\Tf@font{\figureversion{tab}}

% Ease patching
\newcommand*\Tf@@[1]{Tf@@\expandafter\@cdr\string #1\@nil}
\newcommand*\Tf@[1]{\csname \Tf@@{#1}\endcsname}
\newcommand*\Tf@name{}
\newcommand*\Tf@save[1]{%
  \edef\Tf@name{\expandafter\expandafter\expandafter
    \noexpand\Tf@{#1}}%
  \expandafter\newcommand\Tf@name{}%
  \expandafter\let\Tf@name #1%
}
\newcommand*\Tf@def[1]{%
  \Tf@save{#1}%
  \def#1%
}

% Patch \l@... commands
\newcommand*\Tf@pname{}
\newcommand*\Tf@patch@l[1]{%
  \@ifundefined{l@#1}{}{%
    \edef\Tf@pname{\expandafter\noexpand\csname l@#1\endcsname}%
    \expandafter\Tf@save\Tf@pname
    \expandafter\edef\Tf@pname##1##2{%
      \noexpand\Tf@
      \expandafter\noexpand\Tf@pname
      {##1}{\noexpand\Tf@font ##2}%
    }%
  }%
}

% Visual debugging: Tabular figures (by this package) in green
\ifTf@debug
  \RequirePackage{xcolor}%
  \colorlet{Tf@debug}{green!50!black}%
  \renewcommand\Tf@font{\figureversion{tab}\color{Tf@debug}}%
\fi

\endinput
